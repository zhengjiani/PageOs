<p>python用selenium做自动化测试（一）</p>
<a id="more"></a>
<p>﻿python 用selenium做自动化测试：</p>
<p><img src="https://github.com/zhengjiani/markdownImages/blob/master/1538832115545.png?raw=true" alt="1538832115545"></p>
<p>在w3school里搜索css</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 test_w3school_search.py</span><br></pre></td></tr></table></figure>
<p><img src="https://github.com/zhengjiani/markdownImages/blob/master/1538832221692.png?raw=true" alt="1538832221692"></p>
<p>XPath路径表达式：</p>
<p><a href="http://www.ruanyifeng.com/blog/2009/07/xpath_path_expressions.html阮一峰" target="_blank" rel="noopener">http://www.ruanyifeng.com/blog/2009/07/xpath_path_expressions.html阮一峰</a></p>
<p>1.基于Python的Selenium自动化测试</p>
<p>练习实例，把官方教程中能实现的方法都实现一下(在上面的案例中进行更改)</p>
<p>直接执行：直接用<code>unittest.main()</code> 执行，这里它搜索所有以test开头的测试用例方法，按照ASCII的顺序执行多个用例。</p>
<ul>
<li><p>与页面交互(输出W3School中HTML教程中的相关列表文本)</p>
<p>因为我没有用到测试套件，所以测试的时候打开了两次浏览器，但其实在第一次打开浏览器的时候就已经看到了输出，代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">W3schoollist</span><span class="params">(unittest.TestCase)</span>:</span></span><br><span class="line"> <span class="number">26</span>     <span class="function"><span class="keyword">def</span> <span class="title">setUp</span><span class="params">(self)</span>:</span></span><br><span class="line"> <span class="number">27</span>         binary=FirefoxBinary(<span class="string">'/usr/local/firefox/firefox'</span>)</span><br><span class="line"> <span class="number">28</span>         self.driver=webdriver.Firefox(firefox_binary=binary)</span><br><span class="line"> <span class="number">29</span>     <span class="function"><span class="keyword">def</span> <span class="title">test_list_in_w3school</span><span class="params">(self)</span>:</span>    </span><br><span class="line"> <span class="number">30</span>         driver=self.driver</span><br><span class="line"> <span class="number">31</span>         driver.get(<span class="string">"http://www.w3school.com.cn"</span>)</span><br><span class="line">    		<span class="comment">#google开发者工具里面可以直接copy XPath.</span></span><br><span class="line"> <span class="number">32</span>         elems=driver.find_elements_by_xpath(<span class="string">"//*[@id='navsecond']/ul[1]/li"</span>)</span><br><span class="line"> <span class="number">33</span>         <span class="keyword">for</span> ele <span class="keyword">in</span> elems:</span><br><span class="line"> <span class="number">34</span>             <span class="keyword">print</span> ele.text</span><br><span class="line"> <span class="number">35</span>     <span class="function"><span class="keyword">def</span> <span class="title">tearDown</span><span class="params">(self)</span>:</span></span><br><span class="line"> <span class="number">36</span>         self.driver.close()</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="https://github.com/zhengjiani/markdownImages/blob/master/markdownImages/w3school2.png?raw=true" alt="1538881251637"></p>
<ul>
<li>选择下拉列表，处理<code>SELECT</code>元素</li>
<li>控制浏览器前进后退：</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"> <span class="number">1</span> <span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"> <span class="number">2</span> <span class="keyword">from</span> selenium.webdriver.firefox.firefox_binary <span class="keyword">import</span> FirefoxBinary</span><br><span class="line"> <span class="number">3</span> </span><br><span class="line"> <span class="number">4</span> binary=FirefoxBinary(<span class="string">'/usr/local/firefox/firefox'</span>)</span><br><span class="line"> <span class="number">5</span> driver=webdriver.Firefox(firefox_binary=binary)</span><br><span class="line"> <span class="number">6</span> first_url=<span class="string">"http://www.baidu.com"</span></span><br><span class="line"> <span class="number">7</span> print(<span class="string">"now access %s "</span>%(first_url))</span><br><span class="line"> <span class="number">8</span> driver.get(first_url)</span><br><span class="line"> <span class="number">9</span> </span><br><span class="line"><span class="number">10</span> second_url=<span class="string">'http://news.baidu.com'</span></span><br><span class="line"><span class="number">11</span> print(<span class="string">"now access %s"</span>%(second_url))</span><br><span class="line"><span class="number">12</span> driver.get(second_url)</span><br><span class="line"><span class="number">13</span> </span><br><span class="line"><span class="number">14</span> print(<span class="string">"back to %s"</span>%(second_url))</span><br><span class="line"><span class="number">15</span> driver.back()</span><br><span class="line"><span class="number">17</span> print(<span class="string">"forward to %s"</span>%(second_url))</span><br><span class="line"><span class="number">18</span> driver.forward()</span><br><span class="line"><span class="number">19</span> driver.quit()</span><br></pre></td></tr></table></figure>
<p><img src="https://github.com/zhengjiani/markdownImages/blob/master/markdownImages/test1.png?raw=true" alt="1539067140860"></p>
<ul>
<li>qq邮箱登录：</li>
</ul>
<p>一直定位不到元素，最后看了这篇博客解决：</p>
<p><a href="https://blog.csdn.net/otianye/article/details/78203435" target="_blank" rel="noopener">https://blog.csdn.net/otianye/article/details/78203435</a></p>
<p>需要先通过定位frame然后再定位frame里边的某一个元素的方法定位此元素</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> <span class="number">1</span> <span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"> <span class="number">2</span> <span class="keyword">from</span> selenium.webdriver.firefox.firefox_binary <span class="keyword">import</span> FirefoxBinary</span><br><span class="line"> <span class="number">3</span> </span><br><span class="line"> <span class="number">4</span> binary=FirefoxBinary(<span class="string">'/usr/local/firefox/firefox'</span>)</span><br><span class="line"> <span class="number">5</span> driver=webdriver.Firefox(firefox_binary=binary)</span><br><span class="line"> <span class="number">6</span> </span><br><span class="line"> <span class="number">7</span> </span><br><span class="line"> <span class="number">8</span> driver.get(<span class="string">"https://mail.qq.com/"</span>)</span><br><span class="line"> <span class="number">9</span> driver.switch_to_frame(<span class="string">"login_frame"</span>)</span><br><span class="line"><span class="number">10</span> driver.find_element_by_id(<span class="string">"u"</span>).clear()</span><br><span class="line"><span class="number">11</span> driver.find_element_by_id(<span class="string">"u"</span>).send_keys(<span class="string">"username@qq.com"</span>)</span><br><span class="line"><span class="number">12</span> driver.find_element_by_xpath(<span class="string">"//*[@id='p']"</span>).clear()</span><br><span class="line"><span class="number">13</span> driver.find_element_by_xpath(<span class="string">"//[@id='p']"</span>).send_keys(<span class="string">"passward"</span>)</span><br><span class="line"><span class="number">14</span> driver.find_element_by_xpath(<span class="string">"//[@id='login_button']"</span>).click()</span><br><span class="line"><span class="number">15</span> driver.quit()</span><br></pre></td></tr></table></figure>
<ul>
<li>submit()方法用于提交表单</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> <span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="number">2</span> <span class="keyword">from</span> selenium.webdriver.firefox.firefox_binary <span class="keyword">import</span> FirefoxBinary</span><br><span class="line"><span class="number">3</span> </span><br><span class="line"><span class="number">4</span> binary=FirefoxBinary(<span class="string">'/usr/local/firefox/firefox'</span>)</span><br><span class="line"><span class="number">5</span> driver=webdriver.Firefox(firefox_binary=binary)</span><br><span class="line"><span class="number">6</span> driver.get(<span class="string">"http://www.youdao.com"</span>)</span><br><span class="line"><span class="number">7</span>driver.find_element_by_id(<span class="string">'translateContent'</span>).send_keys(<span class="string">'hello'</span>)</span><br><span class="line"><span class="number">8</span> driver.find_element_by_id(<span class="string">'translateContent'</span>).submit()</span><br><span class="line"><span class="number">9</span> driver.quit()</span><br></pre></td></tr></table></figure>
<ul>
<li>鼠标事件(将关于鼠标操作方法封装在ActionChains类内提供)</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"> <span class="number">1</span> <span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"> <span class="number">2</span> <span class="keyword">from</span> selenium.webdriver.firefox.firefox_binary <span class="keyword">import</span> FirefoxBinary</span><br><span class="line"> <span class="number">3</span> <span class="keyword">from</span> selenium.webdriver.common.action_chains <span class="keyword">import</span> ActionChains</span><br><span class="line"> <span class="number">4</span> </span><br><span class="line"> <span class="number">5</span> binary=FirefoxBinary(<span class="string">'/usr/local/firefox/firefox'</span>)</span><br><span class="line"> <span class="number">6</span> driver=webdriver.Firefox(firefox_binary=binary)</span><br><span class="line"> <span class="number">7</span> first_url=<span class="string">"http://sahitest.com/demo/index.htm"</span></span><br><span class="line"> <span class="number">8</span> driver.get(first_url)</span><br><span class="line"> <span class="number">9</span> mouseover_url=<span class="string">"http://sahitest.com/demo/mouseover.htm"</span></span><br><span class="line"><span class="number">10</span> driver.get(mouseover_url)</span><br><span class="line"><span class="number">11</span> driver.find_element_by_name(<span class="string">"t1"</span>).clear()</span><br><span class="line"><span class="number">12</span> driver.find_element_by_name(<span class="string">"t1"</span>).send_keys(<span class="string">"username"</span>)</span><br><span class="line"><span class="number">13</span> above=driver.find_element_by_name(<span class="string">"t1"</span>)</span><br><span class="line">   <span class="comment">#鼠标悬停</span></span><br><span class="line"><span class="number">14</span> ActionChains(driver).move_to_element(above).perform()</span><br><span class="line"><span class="number">15</span> driver.back()</span><br><span class="line"><span class="number">16</span> drag_url=<span class="string">"http://sahitest.com/demo/dragDropMooTools.htm"</span></span><br><span class="line"><span class="number">17</span> driver.get(drag_url)</span><br><span class="line"><span class="number">18</span> element=driver.find_element_by_id(<span class="string">"dragger"</span>)</span><br><span class="line"><span class="number">19</span> target=driver.find_element_by_xpath(<span class="string">"/html/body/div[4]"</span>)</span><br><span class="line">   <span class="comment">#鼠标拖放</span></span><br><span class="line"><span class="number">20</span> ActionChains(driver).drag_and_drop(element,target).perform()</span><br><span class="line"><span class="number">21</span> driver.back()</span><br><span class="line"><span class="number">22</span> driver.quit()</span><br></pre></td></tr></table></figure>
<ul>
<li>获得验证信息(以qq邮箱登录为例)</li>
</ul>
<p>2.Selenium和unittest结合</p>
<p>3.Test Suites</p>
<p>参考：<a href="https://blog.csdn.net/u011436666/article/details/73473013" target="_blank" rel="noopener">https://blog.csdn.net/u011436666/article/details/73473013</a></p>
<p>用测试套件的形式组织一下测试(就使用与页面交互的案例中的两个测试用例)：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"> <span class="number">1</span> <span class="keyword">import</span> unittest</span><br><span class="line"> <span class="number">2</span> <span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"> <span class="number">3</span> <span class="keyword">from</span> selenium.webdriver.common.keys <span class="keyword">import</span> Keys</span><br><span class="line"> <span class="number">4</span> <span class="keyword">from</span> selenium.webdriver.firefox.firefox_binary <span class="keyword">import</span> FirefoxBinary</span><br><span class="line"> <span class="number">5</span> <span class="class"><span class="keyword">class</span> <span class="title">W3schooltest</span><span class="params">(unittest.TestCase)</span>:</span></span><br><span class="line"> <span class="number">6</span> </span><br><span class="line"> <span class="number">7</span>     <span class="function"><span class="keyword">def</span> <span class="title">setUp</span><span class="params">(self)</span>:</span></span><br><span class="line"> <span class="number">8</span>         binary = FirefoxBinary(<span class="string">'/usr/local/firefox/firefox'</span>)</span><br><span class="line"> <span class="number">9</span>         self.driver = webdriver.Firefox(firefox_binary=binary)</span><br><span class="line"><span class="number">10</span>         self.driver.implicitly_wait(<span class="number">10</span>)</span><br><span class="line"><span class="number">11</span> </span><br><span class="line"><span class="number">12</span> </span><br><span class="line"><span class="number">13</span>     <span class="function"><span class="keyword">def</span> <span class="title">test_search_in_w3school</span><span class="params">(self)</span>:</span></span><br><span class="line"><span class="number">14</span>         driver = self.driver</span><br><span class="line"><span class="number">15</span>         driver.get(<span class="string">"http://www.w3school.com.cn"</span>)</span><br><span class="line"><span class="number">16</span>         self.assertIn(<span class="string">"w3school"</span>,driver.title)</span><br><span class="line"><span class="number">17</span>         </span><br><span class="line"><span class="number">18</span>         elem=driver.find_element_by_name(<span class="string">"as_q"</span>)</span><br><span class="line"><span class="number">19</span>         elem.send_keys(<span class="string">"css"</span>)</span><br><span class="line"><span class="number">20</span>         elem.send_keys(Keys.RETURN)</span><br><span class="line"><span class="number">21</span>         elem.submit()</span><br><span class="line"><span class="number">22</span>         <span class="keyword">assert</span> <span class="string">"No results found."</span> <span class="keyword">not</span> <span class="keyword">in</span> driver.page_source</span><br><span class="line"><span class="number">23</span>         print(<span class="string">"test01"</span>)</span><br><span class="line"><span class="number">24</span></span><br></pre></td></tr></table></figure>
<p><img src="https://github.com/zhengjiani/markdownImages/blob/master/markdownImages/w3school.png?raw=true" alt="1538883477042"></p>
<p>可以看到运行的两个测试是按照我调用的顺序来的，test2-&gt;test1</p>
<p>4.Selenium-grid</p>
<p>Selenium-Grid可以测试集分布在多个环境中并行运行测试用例。这有两个好处。 首先，如果你有一个大的测试集或者一个运行缓慢的测试集，你可以通过使用Selenium Grid来划分你的测试集，同时使用这些不同的机器来运行不同的测试。另外，如果您必须在多个环境中运行测试套件，您可以让不同的远程机器同时支持并运行您的测试。 在每种情况下，Selenium Grid通过使用并行处理大大缩短了运行套件所需的时间。</p>
<p>这个的使用后期研究后会再总结~</p>
<p>5.美化报告样式和发送结果邮件：</p>
<p>参考：<a href="https://blog.csdn.net/u011436666/article/details/73473013" target="_blank" rel="noopener">https://blog.csdn.net/u011436666/article/details/73473013</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"> <span class="number">1</span> <span class="keyword">import</span> unittest</span><br><span class="line"> <span class="number">2</span> <span class="keyword">import</span> smtplib</span><br><span class="line"> <span class="number">3</span> <span class="keyword">from</span> email.mime.text <span class="keyword">import</span> MIMEText</span><br><span class="line"> <span class="number">4</span> <span class="keyword">from</span> email.header <span class="keyword">import</span> Header</span><br><span class="line"> <span class="number">5</span> <span class="keyword">import</span> time</span><br><span class="line"> <span class="number">6</span> <span class="keyword">import</span> HTMLTestRunner</span><br><span class="line"> <span class="number">7</span> <span class="keyword">from</span> email.mime.application <span class="keyword">import</span> MIMEApplication</span><br><span class="line"> <span class="number">8</span> <span class="comment">#发送邮件</span></span><br><span class="line"> <span class="number">9</span> <span class="function"><span class="keyword">def</span> <span class="title">send_email</span><span class="params">(report_file)</span>:</span></span><br><span class="line"><span class="number">10</span>     sender = <span class="string">"*@qq.com"</span></span><br><span class="line"><span class="number">11</span>     receiver=<span class="string">"*@qq.com"</span></span><br><span class="line"><span class="number">12</span>     smtpserver=<span class="string">"smtp.qq.com"</span></span><br><span class="line"><span class="number">13</span>     username=<span class="string">"*@qq.com"</span></span><br><span class="line"><span class="number">14</span>     password=<span class="string">"授权码"</span></span><br><span class="line"><span class="number">15</span> <span class="comment">#邮件正文</span></span><br><span class="line"><span class="number">16</span>     file=open(report_file,<span class="string">"rb"</span>)</span><br><span class="line"><span class="number">17</span>     mail_body=file.read()</span><br><span class="line"><span class="number">18</span>     file.close()</span><br><span class="line"><span class="number">19</span> </span><br><span class="line"><span class="number">20</span>     msg=MIMEText(mail_body,_subtype=<span class="string">"html"</span>,_charset=<span class="string">"utf-8"</span>)</span><br><span class="line"><span class="number">21</span>     msg[<span class="string">"Subject"</span>]= <span class="string">u"test_report"</span></span><br><span class="line"><span class="number">22</span> </span><br><span class="line"><span class="number">23</span>     smtp=smtplib.SMTP_SSL(<span class="string">"smtp.qq.com"</span>)</span><br><span class="line"><span class="number">24</span>     smtp.login(username,password)</span><br><span class="line"><span class="number">25</span>     smtp.sendmail(sender,receiver,msg.as_string())</span><br><span class="line"><span class="number">26</span>     smtp.quit()</span><br><span class="line"><span class="number">27</span>     print(<span class="string">"Email has send out!"</span>)</span><br><span class="line">   <span class="comment">#将用例添加到测试套件中</span></span><br><span class="line"><span class="number">28</span> <span class="function"><span class="keyword">def</span> <span class="title">creatsuite</span><span class="params">()</span>:</span></span><br><span class="line"><span class="number">29</span>     testunit=unittest.TestSuite()</span><br><span class="line"><span class="number">30</span>     test_dir=<span class="string">".//testcase"</span></span><br><span class="line"><span class="number">31</span>          discover=unittest.defaultTestLoader.discover(test_dir,pattern=<span class="string">"test*.py"</span>,top_level_dir=<span class="literal">None</span>)</span><br><span class="line"><span class="number">32</span>     <span class="keyword">for</span> test_suite <span class="keyword">in</span> discover:</span><br><span class="line"><span class="number">33</span>         <span class="keyword">for</span> test_case <span class="keyword">in</span> test_suite:</span><br><span class="line"><span class="number">34</span>             testunit.addTest(test_case)</span><br></pre></td></tr></table></figure>
<p>将HTMLTestRunner.py移入python安装目录(仅支持python2,网上有教程可以修改到支持py3)：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv HTMLTestRunner.py /usr/lib/python2.7/site-packages/</span><br></pre></td></tr></table></figure>
<p>注意：密码是qq邮箱第三方授权码！！!,如果你使用自己的密码则会报错：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smtplib.SMTPAuthenticationError: (535, 'Error: \xc7\xeb\xca\xb9\xd3\xc3\xca\xda\xc8\xa8\xc2\xeb\xb5\xc7\xc2\xbc\xa1\xa3\xcf\xea\xc7\xe9\xc7\xeb\xbf\xb4: http://service.mail.qq.com/cgi-bin/help?subtype=1&amp;&amp;id=28&amp;&amp;no=1001256')</span><br></pre></td></tr></table></figure>
<p><img src="https://github.com/zhengjiani/markdownImages/blob/master/markdownImages/test_email.png?raw=true" alt="1538897674587"></p>
<p>这是发到我邮箱的：</p>
<p><img src="https://github.com/zhengjiani/markdownImages/blob/master/markdownImages/test_report.png?raw=true" alt="在这里插入图片描述"></p>
<p>﻿python用selenium做自动化测试（二）</p>
<a id="more"></a>
<hr>
<ul>
<li>checkbox实践</li>
</ul>
<p>测试对象网址</p>
<p>代码先贴上：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">  <span class="number">1</span> <span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line">  <span class="number">2</span> <span class="keyword">from</span> selenium.webdriver.firefox.firefox_binary <span class="keyword">import</span> FirefoxBinary</span><br><span class="line">  <span class="number">3</span> <span class="keyword">import</span> time</span><br><span class="line">  <span class="number">4</span> </span><br><span class="line">  <span class="number">5</span> binary=<span class="string">"/usr/local/firefox/firefox"</span></span><br><span class="line">  <span class="number">6</span> driver=webdriver.Firefox(firefox_binary=binary)</span><br><span class="line">  <span class="number">7</span> </span><br><span class="line">  <span class="number">8</span> driver.get(<span class="string">"http://sahitest.com/demo/formTest.htm"</span>)</span><br><span class="line"><span class="comment">#因为该网页刚开始有一个警告框，所以解散所有警告框</span></span><br><span class="line">  <span class="number">9</span> driver.switch_to_alert().dismiss()</span><br><span class="line">    <span class="comment">#先选择所有checkbox</span></span><br><span class="line"> <span class="number">10</span> checkboxes=driver.find_elements_by_css_selector(<span class="string">'input[type=checkbox]'</span>)</span><br><span class="line"> <span class="number">11</span> <span class="keyword">for</span> checkbox <span class="keyword">in</span> checkboxes:</span><br><span class="line"> <span class="number">12</span>     checkbox.click()</span><br><span class="line"><span class="comment">#每隔2秒勾选一次</span></span><br><span class="line"> <span class="number">13</span>     time.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="comment">#统计checkbox的个数</span></span><br><span class="line"> <span class="number">14</span> print(len(checkboxes))</span><br><span class="line"><span class="comment">#把页面上最后一个勾给去掉</span></span><br><span class="line"> <span class="number">15</span> driver.find_elements_by_css_selector(<span class="string">'input[type=checkbox]'</span>).pop().click()</span><br><span class="line"> <span class="number">16</span> </span><br><span class="line"> <span class="number">17</span> driver.quit()</span><br></pre></td></tr></table></figure>
<p>刚开始遇到一个报错：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">selenium.common.exceptions.WebDriverException: Message: Process unexpectedly closed with status: 1</span><br></pre></td></tr></table></figure>
<p>最后发现原因是用非root用户进入了。</p>
<ul>
<li>多窗口切换</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> <span class="comment">#!/usr/bin/python3.6</span></span><br><span class="line">  <span class="number">2</span> <span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line">  <span class="number">3</span> </span><br><span class="line">  <span class="number">4</span> <span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line">  <span class="number">5</span> <span class="keyword">from</span> selenium.webdriver.firefox.firefox_binary <span class="keyword">import</span> FirefoxBinary</span><br><span class="line">  <span class="number">6</span> <span class="keyword">import</span> time</span><br><span class="line">  <span class="number">7</span> </span><br><span class="line">  <span class="number">8</span> binary=<span class="string">"/usr/local/firefox/firefox"</span></span><br><span class="line">  <span class="number">9</span> driver=webdriver.Firefox(firefox_binary=binary)</span><br><span class="line"> <span class="number">10</span> driver.implicitly_wait(<span class="number">10</span>)</span><br><span class="line"> <span class="number">11</span> driver.get(<span class="string">"https://www.baidu.com/"</span>)</span><br><span class="line"><span class="comment">#获得当前窗口的句柄并赋值</span></span><br><span class="line"> <span class="number">12</span> sreach_windows=driver.current_window_handle</span><br><span class="line">    <span class="comment">#打开登录弹窗</span></span><br><span class="line"> <span class="number">13</span> driver.find_element_by_link_text(<span class="string">'登录'</span>).click()</span><br><span class="line"><span class="comment">#从登录弹窗上打开新的注册窗口</span></span><br><span class="line"> <span class="number">14</span> driver.find_element_by_xpath(<span class="string">"//*[@id='passport-login-pop-dialog']/div/div/div/div[4]/a"</span>).click()</span><br><span class="line"> <span class="number">15</span> <span class="comment">#获取当前打开的所有窗口句柄</span></span><br><span class="line"> <span class="number">16</span> all_handles=driver.window_handles</span><br><span class="line"> <span class="number">17</span> <span class="keyword">for</span> handle <span class="keyword">in</span> all_handles:</span><br><span class="line"> <span class="number">18</span>     <span class="keyword">if</span> handle != sreach_windows:</span><br><span class="line"> <span class="number">19</span>         driver.switch_to.window(handle)</span><br><span class="line"> <span class="number">20</span>         print(<span class="string">'now register window'</span>)</span><br><span class="line"> <span class="number">21</span>         driver.find_element_by_name(<span class="string">"username"</span>).send_keys(<span class="string">'zhengjiani'</span>)</span><br><span class="line"> <span class="number">22</span>         time.sleep(<span class="number">2</span>)</span><br><span class="line"> <span class="number">23</span> <span class="keyword">for</span> handle <span class="keyword">in</span> all_handles:</span><br><span class="line"> <span class="number">24</span>     <span class="keyword">if</span> handle == sreach_windows:</span><br><span class="line"> <span class="number">25</span>         driver.switch_to.window(handle)</span><br><span class="line"> <span class="number">26</span>         print(<span class="string">'now sreach window!'</span>)</span><br><span class="line"> <span class="number">27</span>         driver.find_element_by_id(<span class="string">'TANGRAM__PSP_4__closeBtn'</span>).click()</span><br><span class="line"> <span class="number">28</span>         driver.find_element_by_id(<span class="string">"kw"</span>).send_keys(<span class="string">"selenium"</span>)</span><br><span class="line"> <span class="number">29</span>         driver.find_element_by_id(<span class="string">"su"</span>).click()</span><br><span class="line"> <span class="number">30</span>         time.sleep(<span class="number">2</span>)</span><br><span class="line"> <span class="number">31</span> driver.quit()</span><br></pre></td></tr></table></figure>
<ul>
<li>上传文件</li>
</ul>
<p>虫师书中是对windows控件的操作部分，故不做实验</p>
<ul>
<li>下载文件</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">1 #!/usr/bin/python3.6</span><br><span class="line"> 2 #-*- coding:utf-8 -*-</span><br><span class="line"> 3 from selenium import webdriver</span><br><span class="line"> 4 from selenium.webdriver.firefox.firefox_binary import FirefoxBinary</span><br><span class="line"> 5 import os</span><br><span class="line"> 6 </span><br><span class="line"> 7 fp=webdriver.FirefoxProfile()</span><br><span class="line"> 8 fp.set_preference("browser.download.folderList",2)</span><br><span class="line"> 9 fp.set_preference("browser.download.manager.showWhenStarting",False)</span><br><span class="line">10 fp.set_preference("browser.download.dir",os.getcwd())</span><br><span class="line">11 fp.set_preference("browers.helperApps.neverAsk.saveToDisk","application/octet-stream")</span><br><span class="line">12 binary="/usr/local/firefox/firefox"</span><br><span class="line">13 driver=webdriver.Firefox(firefox_binary=binary,firefox_profile=fp)</span><br><span class="line">14 driver.get("http://pypi.Python.org/pypi/selenium")</span><br><span class="line">15 driver.find_element_by_xpath("//*[@id='mobile-files-tab']").click()</span><br></pre></td></tr></table></figure>
<p>代码就是这样，but网速太渣没出结果</p>
<ul>
<li>调用JS</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> <span class="comment">#!/usr/bin/python3.6</span></span><br><span class="line"> <span class="number">2</span> <span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"> <span class="number">3</span> <span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"> <span class="number">4</span> <span class="keyword">from</span> selenium.webdriver.firefox.firefox_binary <span class="keyword">import</span> FirefoxBinary</span><br><span class="line"> <span class="number">5</span> <span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"> <span class="number">6</span> binary=<span class="string">"/usr/local/firefox/firefox"</span></span><br><span class="line"> <span class="number">7</span> driver=webdriver.Firefox(firefox_binary=binary)</span><br><span class="line"> <span class="number">8</span> driver.get(<span class="string">"https://www.baidu.com"</span>)</span><br><span class="line"> <span class="number">9</span> <span class="comment">#设置浏览器窗口大小</span></span><br><span class="line"><span class="number">10</span> driver.set_window_size(<span class="number">600</span>,<span class="number">600</span>)</span><br><span class="line"><span class="number">11</span> driver.find_element_by_id(<span class="string">"kw"</span>).send_keys(<span class="string">"selenium"</span>)</span><br><span class="line"><span class="number">12</span> driver.find_element_by_id(<span class="string">"su"</span>).click()</span><br><span class="line"><span class="number">13</span> sleep(<span class="number">2</span>)</span><br><span class="line"><span class="number">14</span> js=<span class="string">"window.scrollTo(100,450);"</span></span><br><span class="line"><span class="number">15</span> driver.execute_script(js)</span><br><span class="line"><span class="number">16</span> sleep(<span class="number">3</span>)</span><br><span class="line"><span class="number">17</span> driver.quit()</span><br></pre></td></tr></table></figure>
<ul>
<li>验证码处理</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="模块化驱动测试实例："><a href="#模块化驱动测试实例：" class="headerlink" title="模块化驱动测试实例："></a>模块化驱动测试实例：</h4><p>线性：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"> 1 from selenium import webdriver</span><br><span class="line"> 2 from selenium.webdriver.firefox.firefox_binary import FirefoxBinary</span><br><span class="line"> 3 import time</span><br><span class="line"> 4 </span><br><span class="line"> 5 binary=FirefoxBinary('/usr/local/firefox/firefox')</span><br><span class="line"> 6 driver=webdriver.Firefox(firefox_binary=binary)</span><br><span class="line"> 7 print('Before login================')</span><br><span class="line"> 8 title=driver.title</span><br><span class="line"> 9 print(title)</span><br><span class="line">10 now_url=driver.current_url</span><br><span class="line">11 print(now_url)</span><br><span class="line">12 </span><br><span class="line">13 driver.implicitly_wait(10)</span><br><span class="line">14 driver.get("https://mail.qq.com/")</span><br><span class="line">15 driver.switch_to_frame("login_frame")</span><br><span class="line">16 driver.find_element_by_id("u").clear()</span><br><span class="line">17 driver.find_element_by_id("u").send_keys("*")</span><br><span class="line">18 driver.find_element_by_xpath("//*[@id='p']").clear()</span><br><span class="line">19 driver.find_element_by_xpath("//*[@id='p']").send_keys("*")</span><br><span class="line">20 driver.find_element_by_xpath("//*[@id='login_button']").click()</span><br><span class="line">21 print('After login===================')</span><br><span class="line">22 title=driver.title</span><br><span class="line">23 print(title)</span><br><span class="line">24 now_url=driver.current_url</span><br><span class="line">25 print(now_url)</span><br><span class="line">26 user=driver.find_element_by_xpath("//*[@id='useralias']").text</span><br><span class="line">27 print(user)</span><br><span class="line">28 driver.quit()</span><br></pre></td></tr></table></figure>
<p>模块化：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#登录与退出 public.py</span></span><br><span class="line"> <span class="number">1</span> <span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line">  <span class="number">2</span> <span class="class"><span class="keyword">class</span> <span class="title">Login</span><span class="params">()</span>:</span></span><br><span class="line">  <span class="number">3</span>     <span class="function"><span class="keyword">def</span> <span class="title">user_login</span><span class="params">(self,driver)</span>:</span></span><br><span class="line">  <span class="number">4</span>         driver.switch_to_frame(<span class="string">"login_frame"</span>)</span><br><span class="line">  <span class="number">5</span>         driver.find_element_by_id(<span class="string">"u"</span>).clear()</span><br><span class="line">  <span class="number">6</span>         driver.find_element_by_id(<span class="string">"u"</span>).send_keys(<span class="string">"936089353@qq.com"</span>)</span><br><span class="line">  <span class="number">7</span>         driver.find_element_by_xpath(<span class="string">"//*[@id='p']"</span>).clear()</span><br><span class="line">  <span class="number">8</span>         driver.find_element_by_xpath(<span class="string">"//*[@id='p']"</span>).send_keys(<span class="string">"Nicezheng_1995@"</span>)</span><br><span class="line">  <span class="number">9</span>         driver.find_element_by_xpath(<span class="string">"//*[@id='login_button']"</span>).click()</span><br><span class="line"> <span class="number">10</span>     <span class="function"><span class="keyword">def</span> <span class="title">user_logout</span><span class="params">(self,driver)</span>:</span></span><br><span class="line"> <span class="number">11</span>         driver.find_element_by_link_text(<span class="string">"退出"</span>).click()</span><br><span class="line"> <span class="number">12</span>         driver.quit()</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>主文件 mailTest.py</span><br><span class="line"> 1 #-*- coding:utf-8 -*-</span><br><span class="line"> 2 from selenium import webdriver</span><br><span class="line"> 3 from selenium.webdriver.firefox.firefox_binary import FirefoxBinary</span><br><span class="line"> 4 from public import Login</span><br><span class="line"> 5 binary=FirefoxBinary('/usr/local/firefox/firefox')</span><br><span class="line"> 6 driver=webdriver.Firefox(firefox_binary=binary)</span><br><span class="line"> 7 driver.implicitly_wait(10)</span><br><span class="line"> 8 driver.get("https://mail.qq.com/")</span><br><span class="line"> 9 </span><br><span class="line">10 Login().user_login(driver)</span><br><span class="line">11 Login().user_logout(driver)</span><br></pre></td></tr></table></figure>
<h4 id="数据驱动测试（参数化）"><a href="#数据驱动测试（参数化）" class="headerlink" title="数据驱动测试（参数化）"></a>数据驱动测试（参数化）</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> <span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"> <span class="number">2</span> <span class="class"><span class="keyword">class</span> <span class="title">Login</span><span class="params">()</span>:</span></span><br><span class="line"> <span class="number">3</span>     <span class="function"><span class="keyword">def</span> <span class="title">user_login</span><span class="params">(self,driver,username,password)</span>:</span></span><br><span class="line"> <span class="number">4</span>         driver.switch_to_frame(<span class="string">"login_frame"</span>)</span><br><span class="line"> <span class="number">5</span>         driver.find_element_by_id(<span class="string">"u"</span>).clear()</span><br><span class="line"> <span class="number">6</span>         driver.find_element_by_id(<span class="string">"u"</span>).send_keys(username)</span><br><span class="line"> <span class="number">7</span>         driver.find_element_by_xpath(<span class="string">"//*[@id='p']"</span>).clear()</span><br><span class="line"> <span class="number">8</span>         driver.find_element_by_xpath(<span class="string">"//*[@id='p']"</span>).send_keys(password)</span><br><span class="line"> <span class="number">9</span>         driver.find_element_by_xpath(<span class="string">"//*[@id='login_button']"</span>).click()</span><br><span class="line"><span class="number">10</span>     <span class="function"><span class="keyword">def</span> <span class="title">user_logout</span><span class="params">(self,driver)</span>:</span></span><br><span class="line"><span class="number">11</span>         driver.find_element_by_link_text(<span class="string">"退出"</span>).click()</span><br><span class="line"><span class="number">12</span>         driver.quit()</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> <span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line">  <span class="number">2</span> <span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line">  <span class="number">3</span> <span class="keyword">from</span> selenium.webdriver.firefox.firefox_binary <span class="keyword">import</span> FirefoxBinary</span><br><span class="line">  <span class="number">4</span> <span class="keyword">from</span> public <span class="keyword">import</span> Login</span><br><span class="line">  <span class="number">5</span> </span><br><span class="line">  <span class="number">6</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginTest</span><span class="params">()</span>:</span></span><br><span class="line">  <span class="number">7</span>     <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">  <span class="number">8</span>         </span><br><span class="line">  <span class="number">9</span>         binary=FirefoxBinary(<span class="string">'/usr/local/firefox/firefox'</span>)</span><br><span class="line"> <span class="number">10</span>         self.driver=webdriver.Firefox(firefox_binary=binary)</span><br><span class="line"> <span class="number">11</span>         self.driver.implicitly_wait(<span class="number">10</span>)</span><br><span class="line"> <span class="number">12</span>         self.driver.get(<span class="string">"https://mail.qq.com/"</span>)</span><br><span class="line"> <span class="number">13</span>     <span class="function"><span class="keyword">def</span> <span class="title">test_admin_login</span><span class="params">(self)</span>:</span></span><br><span class="line"> <span class="number">14</span>         username=<span class="string">'*'</span></span><br><span class="line"> <span class="number">15</span>         password=<span class="string">'*'</span></span><br><span class="line"> <span class="number">16</span>         Login().user_login(self.driver,username,password)</span><br><span class="line"> <span class="number">17</span> </span><br><span class="line"> <span class="number">18</span> LoginTest().test_admin_login()</span><br></pre></td></tr></table></figure>
<p>unittest自动识别测试用例并执行</p>
<p>测试用例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#calculator.py</span></span><br><span class="line"> <span class="number">1</span> <span class="class"><span class="keyword">class</span> <span class="title">Count</span><span class="params">()</span>:</span></span><br><span class="line">  <span class="number">2</span>     <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,a,b)</span>:</span></span><br><span class="line">  <span class="number">3</span>         self.a=int(a)</span><br><span class="line">  <span class="number">4</span>         self.b=int(b)</span><br><span class="line">  <span class="number">5</span>     <span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(self)</span>:</span></span><br><span class="line">  <span class="number">6</span>         <span class="keyword">return</span> self.a+self.b</span><br><span class="line">  <span class="number">7</span>     <span class="function"><span class="keyword">def</span> <span class="title">sub</span><span class="params">(self)</span>:</span></span><br><span class="line">  <span class="number">8</span>         <span class="keyword">return</span> self.a-self.b</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#testadd.py</span></span><br><span class="line">  <span class="number">1</span> <span class="keyword">from</span> calculator <span class="keyword">import</span> Count</span><br><span class="line">  <span class="number">2</span> <span class="keyword">import</span> unittest</span><br><span class="line">  <span class="number">3</span> </span><br><span class="line">  <span class="number">4</span> <span class="class"><span class="keyword">class</span> <span class="title">TestAdd</span><span class="params">(unittest.TestCase)</span>:</span></span><br><span class="line">  <span class="number">5</span>     <span class="function"><span class="keyword">def</span> <span class="title">setUp</span><span class="params">(self)</span>:</span></span><br><span class="line">  <span class="number">6</span>         print(<span class="string">"test case start"</span>)</span><br><span class="line">  <span class="number">7</span>     <span class="function"><span class="keyword">def</span> <span class="title">tearDown</span><span class="params">(self)</span>:</span></span><br><span class="line">  <span class="number">8</span>         print(<span class="string">"test case end"</span>)</span><br><span class="line">  <span class="number">9</span>     <span class="function"><span class="keyword">def</span> <span class="title">test_add</span><span class="params">(self)</span>:</span></span><br><span class="line"> <span class="number">10</span>         j=Count(<span class="number">2</span>,<span class="number">3</span>)</span><br><span class="line"> <span class="number">11</span>         self.assertEqual(j.add(),<span class="number">5</span>)</span><br><span class="line"> <span class="number">12</span>     <span class="function"><span class="keyword">def</span> <span class="title">test_add2</span><span class="params">(self)</span>:</span>  </span><br><span class="line"> <span class="number">13</span>         j=Count(<span class="number">41</span>,<span class="number">76</span>)</span><br><span class="line"> <span class="number">14</span>         self.assertEqual(j.add(),<span class="number">117</span>)</span><br><span class="line"> <span class="number">15</span> <span class="keyword">if</span> __name__==<span class="string">'__main__'</span>:</span><br><span class="line"> <span class="number">16</span>     unittest.main()</span><br><span class="line"> <span class="number">17</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">#testsub.py</span></span><br><span class="line"> <span class="number">1</span> <span class="keyword">from</span> calculator <span class="keyword">import</span> Count</span><br><span class="line"> <span class="number">2</span> <span class="keyword">import</span> unittest</span><br><span class="line"> <span class="number">3</span> </span><br><span class="line"> <span class="number">4</span> </span><br><span class="line"> <span class="number">5</span> <span class="class"><span class="keyword">class</span> <span class="title">TestSub</span><span class="params">(unittest.TestCase)</span>:</span></span><br><span class="line"> <span class="number">6</span>     <span class="function"><span class="keyword">def</span> <span class="title">setUp</span><span class="params">(self)</span>:</span></span><br><span class="line"> <span class="number">7</span>         print(<span class="string">"test case start"</span>)</span><br><span class="line"> <span class="number">8</span>     <span class="function"><span class="keyword">def</span> <span class="title">tearDown</span><span class="params">(self)</span>:</span></span><br><span class="line"> <span class="number">9</span>         print(<span class="string">"test case end"</span>)</span><br><span class="line"><span class="number">10</span>     <span class="function"><span class="keyword">def</span> <span class="title">test_add</span><span class="params">(self)</span>:</span></span><br><span class="line"><span class="number">11</span>         j=Count(<span class="number">2</span>,<span class="number">3</span>)</span><br><span class="line"><span class="number">12</span>         self.assertEqual(j.sub(),<span class="number">-1</span>)</span><br><span class="line"><span class="number">13</span>     <span class="function"><span class="keyword">def</span> <span class="title">test_add2</span><span class="params">(self)</span>:</span>  </span><br><span class="line"><span class="number">14</span>         j=Count(<span class="number">71</span>,<span class="number">46</span>)</span><br><span class="line"><span class="number">15</span>         self.assertEqual(j.sub(),<span class="number">25</span>)</span><br><span class="line"><span class="number">16</span> <span class="keyword">if</span> __name__==<span class="string">'__main__'</span>:</span><br><span class="line"><span class="number">17</span>     unittest.main()</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#runtest.py</span></span><br><span class="line">  <span class="number">1</span> <span class="keyword">import</span> unittest</span><br><span class="line">  <span class="number">2</span> test_dir=<span class="string">'./'</span></span><br><span class="line">  <span class="number">3</span> discover=unittest.defaultTestLoader.discover(test_dir,pattern=<span class="string">"test*.py"</span>)</span><br><span class="line">  <span class="number">4</span> <span class="keyword">if</span> __name__==<span class="string">'__main__'</span>:</span><br><span class="line">  <span class="number">5</span>     runner=unittest.TextTestRunner()</span><br><span class="line">  <span class="number">6</span>     runner.run(discover)</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost unittestcase]# python runtest.py</span><br><span class="line">test case start</span><br><span class="line">test case end</span><br><span class="line">.test case start</span><br><span class="line">test case end</span><br><span class="line">.test case start</span><br><span class="line">test case end</span><br><span class="line">.test case start</span><br><span class="line">test case end</span><br><span class="line">.</span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Ran 4 tests in 0.000s</span><br><span class="line"></span><br><span class="line">OK</span><br></pre></td></tr></table></figure>
 <p>﻿Page Object专题</p>
<p>页面对象模型的设计优势：</p>
<ul>
<li>创造可以被多个测试用例共享的可重用代码。</li>
<li>减少大量重复的代码。</li>
<li>如果用户界面发生改变，则修改只用在一处进行。</li>
</ul>
<a id="more"></a>
<p><img src="https://www.guru99.com/images/AdvanceSelenium/071514_0722_PageObjectM2.png" alt="Page Object Model (POM) &amp; Page Factory in Selenium: Complete Tutorial"></p>
<p>图片来源：</p>
<p><a href="https://www.guru99.com/page-object-model-pom-page-factory-in-selenium-ultimate-guide.html" target="_blank" rel="noopener">https://www.guru99.com/page-object-model-pom-page-factory-in-selenium-ultimate-guide.html</a></p>
<p>目的：测试代码与被测页面对象代码分离，后期如果有页面元素发生了更改，只需要修改相应页面对象的代码(即对应Class文件)，而不需要修改测试的代码。</p>
<p>尽量使用XPath来寻找页面元素。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"> <span class="number">2</span> <span class="keyword">from</span> selenium.webdriver.firefox.firefox_binary <span class="keyword">import</span> FirefoxBinary</span><br><span class="line"> <span class="number">3</span> <span class="keyword">import</span> time</span><br><span class="line"> <span class="number">4</span> </span><br><span class="line"> <span class="number">5</span> binary=FirefoxBinary(<span class="string">'/usr/local/firefox/firefox'</span>)</span><br><span class="line"> <span class="number">6</span> driver=webdriver.Firefox(firefox_binary=binary)</span><br><span class="line"> <span class="number">7</span> print(<span class="string">'Before login================'</span>)</span><br><span class="line"> <span class="number">8</span> title=driver.title</span><br><span class="line"> <span class="number">9</span> print(title)</span><br><span class="line"><span class="number">10</span> now_url=driver.current_url</span><br><span class="line"><span class="number">11</span> print(now_url)</span><br><span class="line"><span class="number">12</span> </span><br><span class="line"><span class="number">13</span> driver.implicitly_wait(<span class="number">10</span>)</span><br><span class="line"><span class="number">14</span> driver.get(<span class="string">"https://mail.qq.com/"</span>)</span><br><span class="line"><span class="number">15</span> driver.switch_to_frame(<span class="string">"login_frame"</span>)</span><br><span class="line"><span class="number">16</span> driver.find_element_by_id(<span class="string">"u"</span>).clear()</span><br><span class="line"><span class="number">17</span> driver.find_element_by_id(<span class="string">"u"</span>).send_keys(<span class="string">"*"</span>)</span><br><span class="line"><span class="number">18</span> driver.find_element_by_xpath(<span class="string">"//*[@id='p']"</span>).clear()</span><br><span class="line"><span class="number">19</span> driver.find_element_by_xpath(<span class="string">"//*[@id='p']"</span>).send_keys(<span class="string">"*"</span>)</span><br><span class="line"><span class="number">20</span> driver.find_element_by_xpath(<span class="string">"//*[@id='login_button']"</span>).click()</span><br><span class="line"><span class="number">21</span> print(<span class="string">'After login==================='</span>)</span><br><span class="line"><span class="number">22</span> title=driver.title</span><br><span class="line"><span class="number">23</span> print(title)</span><br><span class="line"><span class="number">24</span> now_url=driver.current_url</span><br><span class="line"><span class="number">25</span> print(now_url)</span><br><span class="line"><span class="number">26</span> user=driver.find_element_by_xpath(<span class="string">"//*[@id='useralias']"</span>).text</span><br><span class="line"><span class="number">27</span> print(user)</span><br><span class="line"><span class="number">28</span> driver.quit()</span><br></pre></td></tr></table></figure>
<p>用PageObject改造后：page.py,element.py,locators.py,测试文件是test_qq.py</p>
<p>参照</p>
<p>的写法写了一下，执行时长11s.</p>
<p>test_qq.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"> <span class="number">1</span> <span class="keyword">import</span> unittest</span><br><span class="line"> <span class="number">2</span> <span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"> <span class="number">3</span> <span class="keyword">from</span> selenium.webdriver.firefox.firefox_binary <span class="keyword">import</span> FirefoxBinary</span><br><span class="line"> <span class="number">4</span> <span class="keyword">import</span> page</span><br><span class="line"> <span class="number">5</span> <span class="keyword">import</span> time</span><br><span class="line"> <span class="number">6</span> </span><br><span class="line"> <span class="number">7</span> </span><br><span class="line"> <span class="number">8</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginQQ</span><span class="params">(unittest.TestCase)</span>:</span></span><br><span class="line"> <span class="number">9</span>     <span class="function"><span class="keyword">def</span> <span class="title">setUp</span><span class="params">(self)</span>:</span></span><br><span class="line"><span class="number">10</span>         binary=FirefoxBinary(<span class="string">'/usr/local/firefox/firefox'</span>)</span><br><span class="line"><span class="number">11</span>         self.driver = webdriver.Firefox(firefox_binary=binary)</span><br><span class="line"><span class="number">12</span>         self.driver.implicitly_wait(<span class="number">10</span>)</span><br><span class="line"><span class="number">13</span>         self.driver.get(<span class="string">"https://mail.qq.com/"</span>)</span><br><span class="line">   		<span class="comment">#跳转表单，这里没有分割出来，需要改进</span></span><br><span class="line"><span class="number">14</span>         self.driver.switch_to_frame(<span class="string">"login_frame"</span>)</span><br><span class="line"><span class="number">15</span>     <span class="function"><span class="keyword">def</span> <span class="title">test_login</span><span class="params">(self)</span>:</span></span><br><span class="line"><span class="number">16</span>         main_page = page.MainPage(self.driver)</span><br><span class="line">           <span class="comment">#测试数据</span></span><br><span class="line"><span class="number">17</span>         main_page.input_username=<span class="string">"*"</span></span><br><span class="line"><span class="number">18</span>         main_page.input_password=<span class="string">"*"</span></span><br><span class="line"><span class="number">19</span>         main_page.click_button()</span><br><span class="line"><span class="number">20</span>     <span class="function"><span class="keyword">def</span> <span class="title">tearDown</span><span class="params">(self)</span>:</span></span><br><span class="line"><span class="number">21</span>         self.driver.close()</span><br><span class="line"><span class="number">22</span> <span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:        </span><br><span class="line"><span class="number">23</span>     unittest.main()</span><br></pre></td></tr></table></figure>
<p>page.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> <span class="number">1</span> <span class="keyword">from</span> element <span class="keyword">import</span> BasePageElement</span><br><span class="line"> <span class="number">2</span> <span class="keyword">from</span> locators <span class="keyword">import</span> MainPageLocators</span><br><span class="line"> <span class="number">6</span> <span class="class"><span class="keyword">class</span> <span class="title">UsernameElement</span><span class="params">(BasePageElement)</span>:</span></span><br><span class="line"> <span class="number">7</span>     <span class="comment">#元素定位</span></span><br><span class="line">	locator=<span class="string">'u'</span></span><br><span class="line"> <span class="number">8</span> <span class="class"><span class="keyword">class</span> <span class="title">PasswordElement</span><span class="params">(BasePageElement)</span>:</span>    </span><br><span class="line"> <span class="number">9</span>     locator=<span class="string">'p'</span></span><br><span class="line"><span class="number">10</span> <span class="class"><span class="keyword">class</span> <span class="title">BasePage</span><span class="params">(object)</span>:</span></span><br><span class="line"><span class="number">11</span>     <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,driver)</span>:</span></span><br><span class="line"><span class="number">12</span>         self.driver=driver</span><br><span class="line"><span class="number">13</span> <span class="class"><span class="keyword">class</span> <span class="title">MainPage</span><span class="params">(BasePage)</span>:</span></span><br><span class="line"><span class="number">14</span>     input_username=UsernameElement()</span><br><span class="line"><span class="number">15</span>     input_password=PasswordElement()</span><br><span class="line"><span class="number">16</span>     <span class="function"><span class="keyword">def</span> <span class="title">click_button</span><span class="params">(self)</span>:</span></span><br><span class="line"><span class="number">17</span>         element=self.driver.find_element(*MainPageLocators.login_loc)</span><br><span class="line"><span class="number">18</span>         element.click()</span><br></pre></td></tr></table></figure>
<p>element.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> <span class="number">1</span><span class="comment">#元素操作</span></span><br><span class="line"> <span class="number">2</span> <span class="class"><span class="keyword">class</span> <span class="title">BasePageElement</span><span class="params">(object)</span>:</span></span><br><span class="line"> <span class="number">3</span>     <span class="function"><span class="keyword">def</span> <span class="title">__set__</span><span class="params">(self,obj,value)</span>:</span></span><br><span class="line"> <span class="number">4</span>         driver=obj.driver</span><br><span class="line"> <span class="number">5</span>         driver.find_element_by_id(self.locator).clear()</span><br><span class="line"> <span class="number">6</span>         driver.find_element_by_id(self.locator).send_keys(value)</span><br><span class="line"> <span class="number">7</span>        </span><br><span class="line"> <span class="number">8</span>     <span class="function"><span class="keyword">def</span> <span class="title">__get__</span><span class="params">(self,obj,owner)</span>:</span></span><br><span class="line"> <span class="number">9</span>         driver=obj.driver</span><br><span class="line"><span class="number">10</span>         element=driver.find_element_by_id(self.locator)</span><br><span class="line"><span class="number">11</span>         <span class="keyword">return</span> element.get_attribute(<span class="string">"value"</span>)</span><br></pre></td></tr></table></figure>
<p>locators.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> <span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line"><span class="number">2</span> <span class="class"><span class="keyword">class</span> <span class="title">MainPageLocators</span><span class="params">(object)</span>:</span></span><br><span class="line"><span class="number">3</span>     login_loc = (By.XPATH,<span class="string">"//*[@id='login_button']"</span>)</span><br></pre></td></tr></table></figure>
<p>又经过虫师的书以及网上一些参考，进一步优化PageObject如下。</p>
<p>主要思想：将一个page对象封装成一个HTML页面，然后通过提供的应用程序特定的API来操作页面元素。一个API是关于应用的，一个API是关于HTML的。因此，page对象提供一个易于编程的接口并隐藏窗口中底层的部件。</p>
<ul>
<li>访问一个文本框通过一个访问方法(accessor method)来实现字符串的获取和返回</li>
<li>复选框使用布尔值</li>
<li>按钮被表示为行为导向的方法名。</li>
</ul>
<p>即page对象应当将GUI控件上所有查询和操作数据的行为封装为方法</p>
<p>test_qq.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding=utf-8                                                                              </span></span><br><span class="line">  <span class="number">2</span> <span class="keyword">import</span> unittest</span><br><span class="line">  <span class="number">3</span> </span><br><span class="line">  <span class="number">4</span> <span class="keyword">from</span> po_model <span class="keyword">import</span> LoginPage</span><br><span class="line">  <span class="number">5</span> <span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver                                                             </span><br><span class="line">  <span class="number">6</span> <span class="keyword">from</span> selenium.webdriver.firefox.firefox_binary <span class="keyword">import</span> FirefoxBinary                        </span><br><span class="line">  <span class="number">7</span> <span class="keyword">from</span> po_model <span class="keyword">import</span> test_user_login                                                       </span><br><span class="line">  <span class="number">8</span> <span class="keyword">from</span> time <span class="keyword">import</span> sleep                                                                     </span><br><span class="line">  <span class="number">9</span> <span class="class"><span class="keyword">class</span> <span class="title">test_qq</span><span class="params">(unittest.TestCase)</span>:</span>                                                          </span><br><span class="line"> <span class="number">10</span>     <span class="function"><span class="keyword">def</span> <span class="title">setUp</span><span class="params">(self)</span>:</span>                                                                       </span><br><span class="line"> <span class="number">11</span>         binary=FirefoxBinary(<span class="string">'/usr/local/firefox/firefox'</span>)                                 </span><br><span class="line"> <span class="number">12</span>         self.driver=webdriver.Firefox(firefox_binary=binary)                               </span><br><span class="line"> <span class="number">13</span>         self.driver.implicitly_wait(<span class="number">30</span>)                                                    </span><br><span class="line"> <span class="number">14</span>     <span class="function"><span class="keyword">def</span> <span class="title">test_login</span><span class="params">(self)</span>:</span></span><br><span class="line"> <span class="number">15</span>         username=<span class="string">'*'</span>                                                        </span><br><span class="line"> <span class="number">16</span>         password=<span class="string">'*'</span>                                                         </span><br><span class="line"> <span class="number">17</span>         test_user_login(self.driver,username,password)</span><br><span class="line"> <span class="number">18</span>         sleep(<span class="number">3</span>)</span><br><span class="line"> <span class="number">19</span>         text = self.driver.find_element_by_xpath(<span class="string">"//*[@id='useraddr']"</span>).text               </span><br><span class="line"> <span class="number">20</span>         <span class="keyword">assert</span>(text == <span class="string">'nicezheng@foxmail.com'</span>,<span class="string">"用户名称不匹配，登录失败"</span>)                 </span><br><span class="line"> <span class="number">21</span>     <span class="function"><span class="keyword">def</span> <span class="title">tearDown</span><span class="params">(self)</span>:</span>                                                                    </span><br><span class="line"> <span class="number">22</span>         self.driver.quit()</span><br><span class="line"> <span class="number">23</span> <span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:                                                                 </span><br><span class="line"> <span class="number">24</span>     unittest.main()</span><br></pre></td></tr></table></figure>
<p>po_model.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.firefox.firefox_binary <span class="keyword">import</span> FirefoxBinary</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Page</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    基础类，用于页面对象类的继承</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    login_url=<span class="string">"https://mail.qq.com"</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,selenium_driver,base_url=login_url)</span>:</span></span><br><span class="line">        self.base_url=base_url</span><br><span class="line">        self.driver=selenium_driver</span><br><span class="line">        self.timeout=<span class="number">30</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">on_page</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.driver.current_url == (self.base_url+self.url) </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_open</span><span class="params">(self,url)</span>:</span></span><br><span class="line">        url=self.base_url+url</span><br><span class="line">        self.driver.get(url)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">open</span><span class="params">(self)</span>:</span></span><br><span class="line">        self._open(self.url)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">switch</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.driver.switch_to_frame(self.framename)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">find_element</span><span class="params">(self,*loc)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.driver.find_element(*loc)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginPage</span><span class="params">(Page)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    qq邮箱登录页面模型</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    url=<span class="string">'/'</span></span><br><span class="line">    <span class="comment">#定位器</span></span><br><span class="line">    username_loc=(By.ID,<span class="string">"u"</span>)</span><br><span class="line">    password_loc=(By.ID,<span class="string">"p"</span>)</span><br><span class="line">    login_loc = (By.XPATH,<span class="string">"//*[@id='login_button']"</span>)</span><br><span class="line">    <span class="comment">#Action</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">type_username</span><span class="params">(self,username)</span>:</span></span><br><span class="line">        self.find_element(*self.username_loc).clear()</span><br><span class="line">        self.find_element(*self.username_loc).send_keys(username)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">type_password</span><span class="params">(self,password)</span>:</span></span><br><span class="line">        self.find_element(*self.password_loc).clear()</span><br><span class="line">        self.find_element(*self.password_loc).send_keys(password)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">submit</span><span class="params">(self)</span>:</span>    </span><br><span class="line">        self.find_element(*self.login_loc).click()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_user_login</span><span class="params">(driver,username,password)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    测试获取的用户名/密码是否可以登录</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line"></span><br><span class="line">    login_page=LoginPage(driver)</span><br><span class="line">    login_page.open()</span><br><span class="line">    driver.switch_to_frame(<span class="string">"login_frame"</span>)</span><br><span class="line">    login_page.type_username(username)</span><br><span class="line">    login_page.type_password(password)</span><br><span class="line">    login_page.submit()</span><br></pre></td></tr></table></figure>